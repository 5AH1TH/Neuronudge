{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {

    const ctx = document.getElementById('tasksChart').getContext('2d');

    // Safely pass task stats as JSON string, then parse in JS
    const taskStats = JSON.parse('{{ task_stats | default({"completed":0,"pending":0,"overdue":0}) | tojson | safe }}');

    const completed = Number(taskStats.completed || 0);
    const pending   = Number(taskStats.pending   || 0);
    const overdue   = Number(taskStats.overdue   || 0);

    const data = {
        labels: ['Completed', 'Pending', 'Overdue'],
        datasets: [{
            label: 'Number of Tasks',
            data: [completed, pending, overdue],
            backgroundColor: [
                'rgba(40, 167, 69, 0.7)',
                'rgba(255, 193, 7, 0.7)',
                'rgba(220, 53, 69, 0.7)'
            ],
            borderColor: [
                'rgba(40, 167, 69, 1)',
                'rgba(255, 193, 7, 1)',
                'rgba(220, 53, 69, 1)'
            ],
            borderWidth: 1
        }]
    };

    const config = {
        type: 'bar',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                title: { display: true, text: 'Tasks Overview' }
            },
            scales: {
                y: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
        }
    };

    new Chart(ctx, config);
});
</script>
{% endblock %}
